---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";

import Layout from "@layouts/Layout.astro";
import WorkNavigation from "@components/WorkNavigation.astro";

import buttonToWebsite from "../../assets/images/button-to-website.svg";

export async function getStaticPaths() {
  const works = await getCollection("works");
  return works.map((work) => ({
    params: { slug: work.slug },
    props: { work },
  }));
}

const posts = await getCollection("works");

function getNextWork() {
  let postIndex;
  for (const post of posts) {
    if (post.slug === Astro.params.slug) {
      postIndex = posts.indexOf(post);
      return posts[postIndex + 1];
    }
  }
}
function getPreviousWork() {
  let postIndex;
  for (const post of posts) {
    if (post.slug === Astro.params.slug) {
      postIndex = posts.indexOf(post);
      return posts[postIndex - 1];
    }
  }
}
const previousWork = getPreviousWork();
const nextWork = getNextWork();

const { work } = Astro.props;
const { Content } = await work.render();
---

<Layout title={`${work.data.title} · Réalisations`}>
  <a href="/works" class="absolute top-0 left-0 w-full flex align-center">
    <svg width="24" height="25" viewBox="0 0 24 25" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M1 12.5L24 12.5M1 12.5V12.5C4.96072 13.7377 7.91025 17.0671 8.66148 21.1481L9.18644 24M1 12.5V12.5C4.97897 11.1449 7.91949 7.75161 8.69473 3.62034L9.18644 0.999999"
        stroke="#3D5361"></path>
    </svg>
    Retour à la galerie
  </a>
  <main class="container pt-24 pb-12">
    <div>
      <Content />
      {
        work.data.websiteUrl && (
          <a href={work.data.websiteUrl} target="_blank">
            <Image src={buttonToWebsite} alt={`Vers le site de ${work.data.title}`} />
          </a>
        )
      }
      <div>
        <Image src={work.data.image} alt="" />
      </div>
    </div>
    <WorkNavigation previousWork={previousWork} nextWork={nextWork} />
  </main>
</Layout>
